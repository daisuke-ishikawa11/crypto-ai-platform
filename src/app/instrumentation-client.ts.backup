import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,

  // サンプリング率の設定
  tracesSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,
  
  // セッションサンプリング
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,

  // デバッグモード
  debug: process.env.NODE_ENV === "development",
  
  // 統合設定
  integrations: [
    Sentry.browserTracingIntegration(),
    Sentry.replayIntegration({
      maskAllText: false,
      blockAllMedia: false,
    }),
  ],

  // 環境設定
  environment: process.env.NODE_ENV,
  
  // リリース情報
  release: process.env.NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA,

  beforeSend(event) {
    // Filter out unwanted events
    if (event.exception) {
      const error = event.exception.values?.[0]
      if (error?.value?.includes('ResizeObserver loop limit exceeded')) {
        return null
      }
    }
    return event
  }
})

// エクスポート関数
export const captureException = Sentry.captureException
export const captureMessage = Sentry.captureMessage
export const setUser = Sentry.setUser
export const setTag = Sentry.setTag
export const setExtra = Sentry.setExtra